---
title: サブフロー / ネストフロー
translationKey: sub-flow-nested-flow
description: 自動化におけるサブフロー(ネストフロー)について学びます。ワークフローを他のワークフロー内に埋め込むことで、複雑なロジックを簡素化し、再利用性を高め、メンテナンスを改善します。
keywords:
- サブフロー
- ネストフロー
- ワークフロー自動化
- 再利用性
- モジュラーワークフロー
category: AI Chatbot & Automation
type: glossary
date: '2025-12-19'
lastmod: '2025-12-19'
draft: false
e-title: Sub-flow / Nested Flow
term: さぶふろー / ねすとふろー
url: "/ja/glossary/sub-flow---nested-flow/"
aliases:
- "/ja/glossary/Sub-flow---Nested-Flow/"
---
## サブフロー / ネストされたフローとは?
サブフロー(またはネストされたフロー)は、より大きな親ワークフロー内のステップとして呼び出される、自己完結型のワークフローです。このモジュラーパターンにより、複雑なビジネスロジックを分解し、一貫した再利用と簡素化されたメンテナンスが可能になります。サブフローはソフトウェア関数に類似しており、複数のコンテキストで再利用可能な特定のロジックをカプセル化します。

**例:** 従業員のオンボーディングでは、IT設定、HR コンプライアンス、機器のプロビジョニング、アカウント作成を処理する個別のサブフローがあります。各サブフローは一度開発され、必要な場所で呼び出されます。

## サブフロー / ネストされたフローを使用する理由

### 主な利点

**モジュール性:** 複雑なワークフローを管理可能な論理単位に分割します。

**再利用性:** 共通のロジック(検証、通知、データ変換)を一度構築し、どこでも再利用できます。

**保守性:** サブフローの変更がすべての親ワークフローに即座に反映され、リスクとオーバーヘッドを削減します。

**スケーラビリティ:** より小さく、明確に定義されたピースを組み合わせることで、大規模な自動化の成長と適応が容易になります。

**一貫性:** 同一のプロセスがすべてのワークフローで均一に実行されます。

**セキュリティの強化:** 機密性の高いロジックへのアクセスが分離され、権限によって保護されます。

**エラー処理の改善:** 集中化されたエラー管理がサブフローに適用され、信頼性の高い復旧と統一されたログ記録が実現します。

## サブフロー / ネストされたフローの仕組み

### ステップバイステップのプロセス

**1. サブフローの設計**  
繰り返し可能なロジック(データ検証、通知など)を特定し、定義された入出力を持つスタンドアロンのワークフローとして構築します。

**2. 親ワークフローとの統合**  
必要なデータを入力として渡し、目的のステップでサブフローを呼び出します。

**3. 実行**  
親ワークフローがサブフローをトリガーし、単一の操作として実行されます。実行は同期(親が待機)または非同期(親が継続)の場合があります。

**4. 状態と結果の管理**  
サブフローの結果が返され、後続の処理に利用できます。状態はサブフロー内で管理されますが、必要に応じて親コンテキストにアクセスできます。

**5. ワークフロー間での再利用性**  
同じサブフローが複数の親ワークフローから呼び出され、標準化と迅速な開発をサポートします。

## プラットフォームの例

### Microsoft Power Automate for Desktop

サブフローはExcel、Web、またはWindowsアクションを自動化し、メインワークフロー内で呼び出されます。

### ServiceNow Workflow Studio

サブフロー、アクション、テンプレートは再利用可能なロジックとして構築され、任意のフローで呼び出されます。統合ビルダーはデバッグ、バージョン管理、LLM駆動の会話型フローをサポートします。

### AWS Step Functions

親ステートマシンが子(ネストされた)ワークフローをオーケストレーションし、複雑な階層とドメイン分離をサポートします。

**AWS コードスニペットの例:**
```typescript
const nestedWorkflow = new LegacyWorkflow({ name: "nested-workflow" })
  .step(stepA)
  .then(stepB)
  .commit();

const parentWorkflow = new LegacyWorkflow({ name: "parent-workflow" })
  .step(nestedWorkflow)
  .then(stepC)
  .commit();
```

## 親ワークフロー vs サブフロー: 主要用語

**親ワークフロー:** プロセスを制御し、サブフローをステップとして呼び出すメインの自動化。

**サブフロー / ネストされたフロー:** 親ワークフロー内で実行される、包含された再利用可能なワークフロー。

**再利用可能なコンポーネント:** 繰り返し使用するために設計されたモジュラーワークフローまたはサブフロー。

**状態遷移:** サブフローの呼び出しとその結果の処理を含む、ワークフロー状態間の移動。

**エラー処理:** サブフローの障害を管理し、復旧のために親に問題を伝播するメカニズム。

## 重要性と価値提案

**冗長性の削減:** コードの重複を排除し、ロジックが一元的に更新されます。

**更新の一元化:** 1つの変更がすべての依存ワークフローを更新します。

**複雑なロジックの簡素化:** 大規模なワークフローの理解とデバッグが容易になります。

**チームコラボレーションのサポート:** チームが個別のサブフローを所有し、ドメインの専門知識と分散メンテナンスを可能にします。

**高度なパターンの実現:**
- **並列実行:** 複数のサブフローを同時に呼び出す
- **条件付きロジック:** ランタイム条件に基づいてサブフローを呼び出す
- **ループ:** 条件が満たされるまでサブフローを繰り返し実行
- **一時停止/再開:** サブフローの境界でワークフローを一時停止および再開

ワークフローをサブフローに分解することで、月次コストを削減し、エラーの分離、デバッグ、運用メトリクスを改善できます。

## 一般的なユースケース

### 人事(HR)

**オンボーディング:** IT設定、HR書類、コンプライアンスのサブフロー

**採用:** スクリーニング、面接スケジューリング、オファー作成

### 財務

**支払い処理:** 信用調査、不正検出、取引ログのサブフロー

**請求書管理:** 検証、承認ルーティング、払い戻し

### カスタマーサポート

**チケット受付:** データ検証とアカウントチェックのサブフロー

**エスカレーション:** 異なるエスカレーションパスのサブフロー

### マーケティング

**キャンペーン自動化:** セグメンテーション、パーソナライゼーション、メール配信のサブフロー

### コンプライアンスと監査

**監査準備:** ドキュメント収集、自己チェック、完了追跡

**インシデント管理:** 通知、調査、報告

### 運用

**在庫管理:** 在庫更新、再注文トリガー、サプライヤー検証

**例:** 「信用調査」サブフローは、ローン申請と新規顧客オンボーディングの両方で再利用され、一貫したコンプライアンスと検証ロジックを保証します。

## 技術パターンと機能

### 主要なプラットフォーム機能

**呼び出しと結果の受け渡し:** 親とサブフロー間でデータを受け渡す

**並列サブフロー実行:** 複数のサブフローを同時に実行

**条件分岐:** 条件に基づいてサブフローを実行

**一時停止/再開:** 長時間実行されるフローの一時停止と再開

**状態監視:** 実行ステータスとパフォーマンスを追跡

**エラー伝播:** 集中化されたロジックで障害を処理

### プラットフォーム固有の実装

**Microsoft Power Automate:**  
サブフローはWeb/デスクトップアクションを自動化し、結果を返し、エラーを一元的に処理します。

**ServiceNow Workflow Studio:**  
フロー、サブフロー、カスタムアクションのための統合ビルダーで、デバッグとバージョン管理をサポート。

**AWS Step Functions:**
- **親子パターン:** 親ワークフローがサブフロー(子ワークフロー)をオーケストレーション
- **ドメイン分離:** 支払い、在庫、配送用の個別ワークフロー
- **共有ユーティリティ:** 通知、ログ記録、検証のための再利用可能なサブフロー
- **エラーワークフロー:** 集中化されたエラー処理サブフロー

## モノリシック vs モジュラー(ネストされた)ワークフローアプローチ

| 側面 | モノリシックワークフロー | モジュラー/ネストされたワークフロー |
|--------|---------------------|-------------------------|
| **保守性** | 更新が困難、密結合 | 更新が容易、疎結合 |
| **再利用性** | 低い(冗長なロジック) | 高い(一元化された共通ロジック) |
| **エラー処理** | エラーの分離と追跡が困難 | 一元化され、管理が容易 |
| **スケーラビリティ** | 複雑さによって制限される | サブフローの組み合わせで容易にスケール |
| **デバッグ** | 状態爆発により複雑 | 分離されたエラードメインでシンプル |
| **バージョン管理** | フロー全体の再デプロイが必要 | 個別のサブフローを独立して更新 |

## サブフロー / ネストされたフローのベストプラクティス

**1. モジュール性を考慮した設計**  
関連するステップをカプセル化し、「神」サブフローを避けます。

**2. 命名規則**  
明確性と追跡可能性のために説明的な名前を使用します。

**3. 入出力契約**  
期待されるデータを明確に定義し、スキーマまたは型を使用します。

**4. エラー処理**  
エラーロジックを一元化し、親にエラーを伝播します。

**5. 状態管理**  
サブフローに独自の状態を管理させ、必要に応じて親コンテキストにアクセスします。

**6. アクセス制御**  
機密性の高いサブフローの権限を制限します。

**7. テストとバージョン管理**  
独立してコンテキスト内でテストし、破壊的変更を避けるためにサブフローをバージョン管理します。

**8. ドキュメント化**  
保守性のためにインターフェース、ロジック、使用方法を文書化します。

## サブフロー / ネストされたフローに関するFAQ

**Q: ネストされたフローは複数ステップのワークフローとどう違いますか?**  
A: 複数ステップのワークフローは線形ですが、ネストされたフローは再利用可能なワークフローをコンポーネントとして呼び出します。

**Q: サブフローは並列実行できますか?**  
A: はい、ほとんどのプラットフォームは同時サブフロー実行をサポートしています。

**Q: エラーはどのように処理されますか?**  
A: エラーは上位に伝播し、親ワークフローは再試行、中止、またはエスカレーションできます。

**Q: サブフローは親データにアクセスできますか?**  
A: 定義された入力を受け取ります。より広範なアクセスはプラットフォームのセキュリティ設定に依存します。

**Q: 多くのワークフローで使用されているサブフローを更新するにはどうすればよいですか?**  
A: サブフロー定義を更新すると、すべての親ワークフローが即座に最新バージョンを使用します。

**Q: サブフローが一時停止または中断された場合はどうなりますか?**  
A: 親ワークフローは待機し、必要に応じて再開できます。人間参加型プロセスをサポートします。

**Q: サブフローは複数レベルの深さでネストできますか?**  
A: はい、複雑な階層をサポートします。

## トラブルシューティングとヒント

**サブフローが予期せず失敗する:** 入力データとパラメータを確認し、エラー処理を確認します。

**並列サブフローがパフォーマンスを低下させる:** リソース使用状況を監視し、必要に応じてバッチ処理またはスロットルします。

**結果マッピングが不明確:** 出力を明示的に文書化し、スキーマを使用します。

**バージョン管理の問題:** バージョン管理を実装し、破壊的変更を慎重に管理します。

## 実装ガイダンス

### 設計原則

どのロジックをモジュール化すべきかを明確に理解することから始めます。ワークフロー間で繰り返されるパターンを特定し、サブフローとして抽出します。

### 開発ワークフロー

1. サブフローのスコープと境界を定義
2. 入出力契約を確立
3. コアロジックを実装
4. エラー処理を追加
5. 独立してテスト
6. 親ワークフローと統合
7. 監視と最適化

### パフォーマンスの考慮事項

**データ転送の最小化:** 親とサブフロー間で必要なデータのみを渡す

**実行順序の最適化:** 依存関係を考慮し、可能な限り並列化

**結果のキャッシュ:** 適切な場合にサブフローの出力を再利用

**リソース使用状況の監視:** 実行時間とリソース消費を追跡

### セキュリティのベストプラクティス

**最小権限の原則:** 必要最小限の権限を付与

**入力検証:** サブフローに渡されるすべてのデータを検証

**監査ログ:** コンプライアンスのためにサブフロー呼び出しを追跡

**安全なストレージ:** 転送中および保存中の機密データを保護

## 高度な実装パターン

### 再帰的サブフロー

サブフローは再帰的操作のために自身を呼び出すことができ、階層データの処理や反復計算に有用です。

### 動的サブフロー選択

ランタイム条件を使用して呼び出すサブフローを決定し、柔軟なワークフローオーケストレーションを実現します。

### サブフローチェーン

複数のサブフローを順番にリンクし、各サブフローの出力が次のサブフローに供給されます。

### エラー復旧パターン

堅牢なエラー処理のために、再試行ロジック、フォールバックサブフロー、補償トランザクションを実装します。

## 参考文献

- [Activepieces: Nested Flows](https://resources.activepieces.com/glossary/nested-flows)
- [Way We Do: Introducing Sub-Processes](https://www.waywedo.com/blog/introducing-sub-processes/)
- [Mastra: Nested Workflows (Legacy)](https://mastra.ai/docs/workflows-legacy/nested-workflows)
- [AWS: Modularizing Step Functions Workflows](https://aws.amazon.com/blogs/compute/breaking-down-monolith-workflows-modularizing-aws-step-functions-workflows/)
- [Microsoft: Power Automate Subflows Workshop](https://learn.microsoft.com/en-us/training/modules/create-subflows-web-automation-online-workshop/)
- [ServiceNow: Flow Designer Documentation](https://docs.servicenow.com/csh?version=latest&topicname=flow-designer)
- [ServiceNow: Workflow Studio](https://docs.servicenow.com/csh?version=latest&topicname=workflow-studio)
- [ServiceNow: Zurich Release Notes](https://www.servicenow.com/docs/bundle/zurich-release-notes/page/release-notes/now-platform-app-engine/flow-designer-rn.html)
- [AWS: Step Functions Nested Workflows](https://docs.aws.amazon.com/step-functions/latest/dg/concepts-nested-workflows.html)
- [AWS: Step Functions Best Practices](https://docs.aws.amazon.com/step-functions/latest/dg/best-practices.html)
- [ServiceNow: Flow Guidance & Best Practices](https://sn.works/CoE/StartFlow#h_320418873381665150474199)
- [YouTube: ServiceNow Subflows in Conversational AI](https://www.youtube.com/watch?v=jbRhPq6jREY)
