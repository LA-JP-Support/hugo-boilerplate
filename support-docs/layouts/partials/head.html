<head>
    <meta charset="utf-8" />
    <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
    {{- if not hugo.IsProduction }}
    <meta name="robots" content="noindex">
    {{- end }}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}" />
    <meta name="author" content="SmartWeb" />
    
    <!-- Hreflang tags for multilingual SEO -->
    {{ if .IsTranslated }}
      {{ range .Translations }}
      <link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}" />
      {{ end }}
      <link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}" />
    {{ end }}
    <link rel="alternate" hreflang="x-default" href="{{ .Site.BaseURL }}" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ .Permalink }}" />
    
    <!-- favicon -->
    {{ block "head/favicon" . }}{{ partialCached "head/favicon.html" . }}{{ end }}
    
    <!-- Critical CSS for initial render -->
    <style>
    /* Base styles to prevent layout shift */
    *,*::before,*::after{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;-webkit-font-smoothing:antialiased}
    /* Sidebar layout */
    .page-wrapper{display:flex;min-height:100vh}
    .sidebar-wrapper{flex-shrink:0}
    .page-content{flex-grow:1;min-width:0}
    /* Prevent FOUT */
    .docs-content h1,.docs-content h2,.docs-content h3,.docs-content h4{font-weight:600}
    /* Pagination links (doc-nav) */
    #doc-nav .card-title.fs-5{font-size:0.9rem!important}
    #doc-nav .card-text{font-size:0.85rem!important}
    </style>
    
    <!-- Google Fonts - deferred -->
    {{- partial "google-fonts" . }}
    
    <!-- Custom CSS - async loading -->
    {{- $options := dict "enableSourceMap" true }}
    {{- if hugo.IsProduction}}
        {{- $options := dict "enableSourceMap" false "outputStyle" "compressed" }}
    {{- end }}
    {{- $style := resources.Get "/scss/style.scss" }}
    {{- $style = $style | resources.ExecuteAsTemplate "/scss/style.scss" . | css.Sass $options }}
    {{- if hugo.IsProduction }}
        {{- $style = $style | minify | fingerprint "sha384" }}
    {{- end -}}
    <link rel="stylesheet" href="{{ $style.RelPermalink }}" {{ if hugo.IsProduction }}integrity="{{ $style.Data.Integrity }}"{{ end }} media="print" onload="this.media='all'" />
    <noscript>
        <link rel="stylesheet" href="{{ $style.RelPermalink }}" {{ if hugo.IsProduction }}integrity="{{ $style.Data.Integrity }}"{{ end }} />
    </noscript>
    
    <!-- FlexSearch - deferred -->
    {{ if or (not (isset .Site.Params.flexsearch "enabled")) (eq .Site.Params.flexsearch.enabled true) -}}
        {{ if and (.Site.Params.docsearch.appID) (.Site.Params.docsearch.apiKey) -}}
        {{ else }}
            {{ $flexSearch := resources.Get "/docs/js/flexsearch.bundle.js" }}
            {{- if not hugo.IsServer }}
                {{ $flexSearch := $flexSearch | minify | fingerprint "sha384" }}
                <script type="text/javascript" src="{{ $flexSearch.Permalink }}" integrity="{{ $flexSearch.Data.Integrity }}" crossorigin="anonymous" defer></script>
            {{ else }}
                <script type="text/javascript" src="{{ $flexSearch.Permalink }}" defer></script>
            {{ end }}
        {{ end }}
    {{ end }}
    
    <!-- Bootstrap JS - deferred -->
    {{ $js := resources.Get "js/bootstrap.js" }}
    {{ $params := dict }}
    {{ $sourceMap := cond hugo.IsProduction "" "inline" }}
    {{ $opts := dict "sourceMap" $sourceMap "minify" hugo.IsProduction "target" "es2018" "params" $params }}
    {{ $js = $js | js.Build $opts }}
    {{ if hugo.IsProduction }}
        {{ $js = $js | fingerprint "sha384" }}
    {{ end }}
    <script src="{{ $js.RelPermalink }}" {{ if hugo.IsProduction }}integrity="{{ $js.Data.Integrity }}"{{ end -}} defer></script>
    
    <!-- Image Compare Viewer -->
    {{ if ($.Scratch.Get "image_compare_enabled") }}
        {{ $imagecompare := resources.Get "js/image-compare-viewer.min.js" }}
        {{- if not hugo.IsServer }}
            {{- $js := (slice $imagecompare) | resources.Concat "/js/image-compare.js" | minify | fingerprint "sha384" }}
            <script type="text/javascript" src="{{ $js.Permalink }}" integrity="{{ $js.Data.Integrity }}" defer></script>
        {{- else }}
            {{- $js := (slice $imagecompare) | resources.Concat "/js/image-compare.js" }}
            <script type="text/javascript" src="{{ $js.Permalink }}" defer></script>
        {{- end }}
    {{- end }}
    
    <!-- Plausible Analytics Config -->
    {{- if not hugo.IsServer }}
    {{ if and (.Site.Params.plausible.scriptURL) (.Site.Params.plausible.dataDomain) -}}
        {{- partialCached "head/plausible" . }}
    {{- end -}}
    {{- end -}}
    
    <!-- Google Analytics v4 Config - deferred -->
    {{- if not hugo.IsServer }}
    {{- if .Site.Config.Services.GoogleAnalytics.ID }}
        {{- partial "utils/analytics/google-analytics-deferred.html" . -}}
    {{- end -}}
    {{- end -}}
</head>
