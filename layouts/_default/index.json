{{- $.Scratch.Add "index" slice -}}
{{- range .Site.RegularPages -}}
{{- $dir := "" -}}
{{- if .File -}}
  {{- $path := .File.Dir -}}
  {{- if $path -}}
    {{- $dir = replaceRE "^[a-z]{2}/" "" $path -}}
    {{- $dir = replaceRE "/$" "" $dir -}}
  {{- end -}}
{{- end -}}
{{- $eTitle := index .Params "e-title" -}}
{{/* youtubeVideoIDがある記事にはYouTubeタグを自動追加 */}}
{{- $tags := .Params.tags | default slice -}}
{{- if .Params.youtubeVideoID -}}
  {{- if not (in $tags "YouTube") -}}
    {{- $tags = $tags | append "YouTube" -}}
  {{- end -}}
{{- end -}}
{{- $.Scratch.Add "index" (dict
  "title" .Title
  "eTitle" $eTitle
  "translationKey" .Params.translationKey
  "term" .Params.term
  "tags" $tags
  "categories" .Params.categories
  "keywords" .Params.keywords
  "content" .Params.description
  "searchText" (printf "%v %v %v %v %v %v %v" .Title $eTitle .Params.translationKey .Params.term (.Params.keywords | default slice) .Params.description (replaceRE "[\\s・\\-_/\\.]+" "" (printf "%v%v%v%v" .Title $eTitle .Params.translationKey .Params.term)))
  "permalink" .Permalink
  "readingTime" .ReadingTime
  "date" (.Date.Format "Jan 2, 2006")
  "dir" $dir
  "image" .Params.image
  "lang" .Lang
) -}}
{{- end -}}
{{- /* Include taxonomy terms (e.g., components) in the search index */ -}}
{{- range $taxonomy := .Site.Taxonomies -}}
  {{- range $term := $taxonomy -}}
    {{- $dir := "" -}}
    {{- if $term.Page.File -}}
      {{- $path := $term.Page.File.Dir -}}
      {{- if $path -}}
        {{- $dir = replaceRE "^[a-z]{2}/" "" $path -}}
        {{- $dir = replaceRE "/$" "" $dir -}}
      {{- end -}}
    {{- end -}}
    {{- $eTitle := index $term.Page.Params "e-title" -}}
    {{- $.Scratch.Add "index" (dict
      "title" $term.Page.Title
      "eTitle" $eTitle
      "translationKey" $term.Page.Params.translationKey
      "term" $term.Page.Params.term
      "tags" $term.Page.Params.tags
      "categories" $term.Page.Params.categories
      "keywords" $term.Page.Params.keywords
      "content" $term.Page.Params.description
      "searchText" (printf "%v %v %v %v %v %v %v" $term.Page.Title $eTitle $term.Page.Params.translationKey $term.Page.Params.term ($term.Page.Params.keywords | default slice) $term.Page.Params.description (replaceRE "[\\s・\\-_/\\.]+" "" (printf "%v%v%v%v" $term.Page.Title $eTitle $term.Page.Params.translationKey $term.Page.Params.term)))
      "permalink" $term.Page.Permalink
      "readingTime" $term.Page.ReadingTime
      "date" ($term.Page.Date.Format "Jan 2, 2006")
      "dir" $dir
      "image" $term.Page.Params.image
      "lang" $term.Page.Lang
    ) -}}
  {{- end -}}
{{- end -}}
{{- $.Scratch.Get "index" | jsonify -}}