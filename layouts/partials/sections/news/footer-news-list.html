{{/*
  Footer News List - フッターCTAセクション用お知らせ欄（ダークテーマ）
  
  表示内容：
  - blog セクションの記事 → BLOG タグ
  - news セクション + category: news → NEWS タグ
  - news セクション + category: press-release → PRESS RELEASE タグ
  
  Parameters:
  - limit: 表示件数（デフォルト: 5）
  - page: ページコンテキスト
*/}}

{{ $limit := .limit | default 5 }}
{{ $page := .page }}
{{ $lang := $page.Language.Lang }}

{{/* blog と news の記事を取得 */}}
{{ $blogPages := where (where $page.Site.RegularPages "Section" "blog") "Language.Lang" $lang }}
{{ $newsPages := where (where $page.Site.RegularPages "Section" "news") "Language.Lang" $lang }}

{{/* 全記事を結合してスライスを作成 */}}
{{ $allPages := slice }}
{{ range $blogPages }}
  {{ $allPages = $allPages | append . }}
{{ end }}
{{ range $newsPages }}
  {{ $allPages = $allPages | append . }}
{{ end }}

{{/* 日付順でソートして最新N件を取得 */}}
{{ $sortedPages := sort $allPages "Date" "desc" }}
{{ $latestPages := first $limit $sortedPages }}

{{ if $latestPages }}
<div class="mt-12 w-full max-w-3xl mx-auto">
  <!-- セクションヘッダー -->
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-base font-semibold text-white/90">
      {{ i18n "news_section_title" | default "お知らせ" }}
    </h3>
    <a href="/{{ $lang }}/news/" class="inline-flex items-center text-sm font-medium text-indigo-400 hover:text-indigo-300 transition-colors">
      {{ i18n "view_all" | default "すべて見る" }}
      <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </a>
  </div>

  <!-- お知らせリスト -->
  <div class="divide-y divide-white/10 border-t border-b border-white/10 rounded-lg bg-white/5 backdrop-blur-sm">
    {{ range $latestPages }}
      {{ $targetUrl := .RelPermalink }}
      {{ if .Params.externalUrl }}
        {{ $targetUrl = .Params.externalUrl }}
      {{ end }}
      <a href="{{ $targetUrl }}" {{ if .Params.externalUrl }}target="_blank" rel="noopener noreferrer"{{ end }} class="group flex items-center gap-3 sm:gap-4 py-3 px-4 hover:bg-white/5 transition-colors">
        <!-- 日付 -->
        <time datetime="{{ .Date.Format "2006-01-02" }}" class="flex-shrink-0 text-xs text-gray-400 w-20 font-medium tabular-nums">
          {{ .Date.Format "2006.01.02" }}
        </time>
        
        <!-- カテゴリータグ -->
        <div class="flex-shrink-0 w-24">
          {{ if eq .Section "blog" }}
            {{/* ブログ記事 */}}
            <span class="inline-flex items-center rounded-full border border-emerald-500/50 px-2 py-0.5 text-[10px] font-medium text-emerald-400">
              BLOG
            </span>
          {{ else if eq .Section "news" }}
            {{ $category := .Params.category | default "news" }}
            {{ if eq $category "press-release" }}
              {{/* プレスリリース */}}
              <span class="inline-flex items-center rounded-full border border-blue-500/50 px-2 py-0.5 text-[10px] font-medium text-blue-400 whitespace-nowrap">
                PRESS RELEASE
              </span>
            {{ else }}
              {{/* ニュース */}}
              <span class="inline-flex items-center rounded-full border border-violet-500/50 px-2 py-0.5 text-[10px] font-medium text-violet-400">
                NEWS
              </span>
            {{ end }}
          {{ end }}
        </div>
        
        <!-- タイトル -->
        <h4 class="flex-1 text-sm font-medium text-gray-200 group-hover:text-white transition-colors truncate min-w-0">
          {{ .Title }}
        </h4>
        
        <!-- 矢印（外部リンクの場合は別アイコン） -->
        <span class="flex-shrink-0 text-gray-500 group-hover:text-indigo-400 transition-colors">
          {{ if .Params.externalUrl }}
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
          </svg>
          {{ else }}
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          {{ end }}
        </span>
      </a>
    {{ end }}
  </div>
</div>
{{ end }}
