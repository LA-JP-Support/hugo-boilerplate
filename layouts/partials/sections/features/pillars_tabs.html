{{/*
  Drift-style Tabbed Pillars Section
  
  Parameters:
  - label: Section label (e.g., "AIカスタマーサポート")
  - heading: Section heading (e.g., "4つの柱")
  - description: Section description
  - items: Array of pillar items
  - accentColor: Color theme ("indigo" or "emerald")
  
  Usage:
  {{ partial "sections/features/pillars_tabs.html" (dict
    "label" .Params.pillars_support.label
    "heading" .Params.pillars_support.heading
    "description" .Params.pillars_support.description
    "items" .Params.pillars_support.items
    "accentColor" "indigo"
    "sectionId" "customer-support-tabs"
  ) }}
*/}}

{{ $label := .label | default "" }}
{{ $heading := .heading | default "Features" }}
{{ $description := .description | default "" }}
{{ $items := .items | default slice }}
{{ $accentColor := .accentColor | default "indigo" }}
{{ $sectionId := .sectionId | default "pillars-tabs" }}

{{ $colorClasses := dict 
  "indigo" (dict "text" "text-indigo-600 dark:text-indigo-400" "bg" "bg-indigo-600" "border" "border-indigo-600" "hover" "hover:bg-indigo-50 dark:hover:bg-indigo-900/30")
  "emerald" (dict "text" "text-emerald-600 dark:text-emerald-400" "bg" "bg-emerald-600" "border" "border-emerald-600" "hover" "hover:bg-emerald-50 dark:hover:bg-emerald-900/30")
}}
{{ $colors := index $colorClasses $accentColor }}

{{ $bgStyle := .bgStyle | default "" }}
{{ if not $bgStyle }}
  {{ if eq $accentColor "emerald" }}
    {{ $bgStyle = "light" }}
  {{ else }}
    {{ $bgStyle = "dark" }}
  {{ end }}
{{ end }}

<section id="{{ $sectionId }}" class="pillars-tabs-section pillars-tabs-{{ $bgStyle }} py-24 sm:py-32 bg-white dark:bg-gray-900">
  <style>
    /* Pillars Tabs Section Styles */
    .pillars-tabs-section.pillars-tabs-dark {
      background: #1e3a5f;
    }
    .dark .pillars-tabs-section.pillars-tabs-dark {
      background: #1e3a5f;
    }
    .pillars-tabs-section.pillars-tabs-light {
      background: #f8fafc;
    }
    .dark .pillars-tabs-section.pillars-tabs-light {
      background: #1f2937;
    }
    
    /* Unified Panel Container */
    .pillars-unified-panel {
      background: transparent;
      border: none;
      border-radius: 18px;
      overflow: hidden;
    }
    
    .dark .pillars-unified-panel {
      background: transparent;
    }
    
    /* Tab Navigation */
    .pillars-tab-nav {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      padding: 1.5rem 1.5rem 0 0;
      scrollbar-width: thin;
      justify-content: flex-start;
    }
    
    .pillars-tab-btn {
      flex-shrink: 0;
      background: transparent;
      border: none;
      border-radius: 10px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
      min-width: 180px;
      max-width: 220px;
      position: relative;
    }
    
    .pillars-tabs-dark .pillars-tab-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .pillars-tabs-light .pillars-tab-btn:hover {
      background: rgba(0, 0, 0, 0.05);
    }
    
    .dark .pillars-tab-btn:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .pillars-tabs-dark .pillars-tab-btn.active {
      background: #dbeafe;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 1.25rem 1.5rem;
      border-radius: 10px 10px 0 0;
    }
    
    .pillars-tabs-light .pillars-tab-btn.active {
      background: #dbeafe;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 1.25rem 1.5rem;
      border-radius: 10px 10px 0 0;
    }
    
    .dark .pillars-tab-btn.active {
      background: rgba(59, 130, 246, 0.2);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    
    .pillars-tab-thumb {
      width: 100%;
      height: 80px;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 0.75rem;
      background: transparent;
    }
    
    .pillars-tab-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .pillars-tabs-dark .pillars-tab-title {
      font-size: 0.9375rem;
      font-weight: 600;
      color: #d1d5db;
      line-height: 1.4;
    }
    
    .pillars-tabs-light .pillars-tab-title {
      font-size: 0.9375rem;
      font-weight: 600;
      color: #4b5563;
      line-height: 1.4;
    }
    
    .pillars-tab-btn.active .pillars-tab-title {
      color: #111827;
    }
    
    /* Tab Content Panel */
    .pillars-tabs-dark .pillars-tab-panels {
      background: #dbeafe;
      border-top: 1px solid #93c5fd;
      border-radius: 0 10px 0 0;
      padding: 2.5rem;
      position: relative;
      transition: border-radius 0.2s ease;
    }
    
    .pillars-tabs-light .pillars-tab-panels {
      background: #dbeafe;
      border-top: 1px solid #93c5fd;
      border-radius: 0 10px 0 0;
      padding: 2.5rem;
      position: relative;
      transition: border-radius 0.2s ease;
    }
    
    .pillars-tab-panels.round-top-left {
      border-radius: 10px 10px 0 0;
    }
    
    .dark .pillars-tab-panels {
      background: rgba(59, 130, 246, 0.2);
      border-top-color: #1e40af;
    }
    
    .pillars-tab-content {
      display: none;
      animation: fadeIn 0.4s ease;
    }
    
    .pillars-tab-content.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .pillars-content-grid {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 3rem;
      align-items: center;
    }
    
    @media (max-width: 1024px) {
      .pillars-content-grid {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
    }
    
    .pillars-content-text {
      order: 1;
    }
    
    .pillars-content-image {
      order: 2;
    }
    
    @media (max-width: 1024px) {
      .pillars-content-image {
        order: 1;
      }
      .pillars-content-text {
        order: 2;
      }
    }
    
    .pillars-content-label {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }
    
    .pillars-content-title {
      font-size: 1.875rem;
      font-weight: 700;
      color: #111827;
      margin-bottom: 1rem;
      line-height: 1.3;
    }
    
    .dark .pillars-content-title {
      color: #f9fafb;
    }
    
    .pillars-content-description {
      font-size: 1.0625rem;
      color: #4b5563;
      line-height: 1.8;
      margin-bottom: 1.5rem;
    }
    
    .dark .pillars-content-description {
      color: #9ca3af;
    }
    
    .pillars-content-cta {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      text-decoration: none;
    }
    
    .pillars-content-cta:hover {
      transform: translateX(4px);
    }
    
    .pillars-image-wrapper {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      background: #ffffff;
    }
    
    .dark .pillars-image-wrapper {
      background: #1f2937;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }
    
    .pillars-image-wrapper img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    /* Decorative Elements */
    .pillars-decor {
      position: absolute;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      opacity: 0.03;
      pointer-events: none;
      z-index: 0;
    }
    
    .pillars-decor-1 {
      top: -50px;
      right: -50px;
      background: #059669;
    }
    
    .pillars-decor-2 {
      bottom: -50px;
      left: -50px;
      background: #10b981;
    }
    
    /* Mobile Tab Nav */
    @media (max-width: 640px) {
      .pillars-tab-nav {
        gap: 0.75rem;
      }
      .pillars-tab-btn {
        min-width: 150px;
        padding: 0.75rem;
      }
      .pillars-tab-thumb {
        height: 60px;
      }
      .pillars-tab-panels {
        padding: 1.5rem;
      }
      .pillars-content-title {
        font-size: 1.5rem;
      }
    }
  </style>
  
  <div class="wrapper">
    <!-- Section Header -->
    <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6 mb-12">
      <div class="lg:max-w-2xl">
        {{ if $label }}
        <p class="text-xl font-semibold mb-4 {{ if eq $bgStyle "light" }}text-indigo-600{{ else }}text-blue-300{{ end }}">
          {{ $label }}
        </p>
        {{ end }}
        <h2 class="text-4xl font-bold tracking-tight sm:text-5xl font-mincho {{ if eq $bgStyle "light" }}text-gray-900{{ else }}text-white{{ end }}">
          {{ $heading }}
        </h2>
      </div>
      {{ if $description }}
      <div class="lg:max-w-lg">
        <p class="text-lg leading-relaxed {{ if eq $bgStyle "light" }}text-gray-600{{ else }}text-gray-300{{ end }}">
          {{ $description }}
        </p>
      </div>
      {{ end }}
    </div>
    
    <!-- Unified Panel: Tabs + Content -->
    <div class="pillars-unified-panel">
      <!-- Tab Navigation -->
      <div class="pillars-tab-nav" role="tablist" aria-label="{{ $heading }}">
        {{ range $index, $item := $items }}
        <button 
          class="pillars-tab-btn {{ if eq $index 0 }}active{{ end }} {{ $accentColor }}"
          role="tab"
          aria-selected="{{ if eq $index 0 }}true{{ else }}false{{ end }}"
          aria-controls="{{ $sectionId }}-panel-{{ $index }}"
          data-tab-index="{{ $index }}"
        >
          <div class="pillars-tab-thumb {{ $accentColor }}">
            {{ if $item.image }}
            {{ partial "components/media/lazyimg_internal.html" (dict
              "src" (partial "functions/get-localized-image.html" $item.image)
              "alt" $item.title
              "maxWidth" 300
              "class" ""
            ) }}
            {{ end }}
          </div>
          <div class="pillars-tab-title">{{ $item.title }}</div>
        </button>
        {{ end }}
      </div>
      
      <!-- Tab Content Panels -->
      <div class="pillars-tab-panels relative">
      <!-- Decorative Elements -->
      <div class="pillars-decor pillars-decor-1"></div>
      <div class="pillars-decor pillars-decor-2"></div>
      
      {{ range $index, $item := $items }}
      <div 
        class="pillars-tab-content {{ if eq $index 0 }}active{{ end }}"
        id="{{ $sectionId }}-panel-{{ $index }}"
        role="tabpanel"
        aria-labelledby="{{ $sectionId }}-tab-{{ $index }}"
      >
        <div class="pillars-content-grid">
          <!-- Text Content -->
          <div class="pillars-content-text">
            {{ if $item.label }}
            <p class="pillars-content-label {{ $colors.text }}">{{ $item.label }}</p>
            {{ end }}
            <h3 class="pillars-content-title">{{ $item.title }}</h3>
            <p class="pillars-content-description">{{ $item.description }}</p>
            {{ if $item.url }}
            <a href="{{ $item.url }}" class="pillars-content-cta {{ $colors.text }} {{ $colors.hover }} border {{ $colors.border }}" aria-label="{{ i18n "learn_more_about_prefix" }}{{ $item.title }}{{ i18n "learn_more_about_suffix" }}">
              {{ i18n "learn_more_about_prefix" }}{{ $item.title }}{{ i18n "learn_more_about_suffix" }}
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
              </svg>
            </a>
            {{ end }}
          </div>
          
          <!-- Image -->
          <div class="pillars-content-image">
            <div class="pillars-image-wrapper">
              {{ if $item.image }}
              {{ partial "components/media/lazyimg_internal.html" (dict
                "src" (partial "functions/get-localized-image.html" $item.image)
                "alt" $item.title
                "maxWidth" 800
                "class" ""
              ) }}
              {{ else }}
              <div class="aspect-[4/3] flex items-center justify-center">
                <svg class="w-20 h-20 {{ $colors.text }} opacity-30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                </svg>
              </div>
              {{ end }}
            </div>
          </div>
        </div>
      </div>
      {{ end }}
      </div>
    </div>
  </div>
</section>

<script>
function switchPillarsTab(sectionId, index) {
  const section = document.getElementById(sectionId);
  if (!section) return;
  
  // Update tab buttons
  const buttons = section.querySelectorAll('.pillars-tab-btn');
  buttons.forEach((btn, i) => {
    btn.classList.toggle('active', i === index);
    btn.setAttribute('aria-selected', i === index ? 'true' : 'false');
  });
  
  // Update content panels
  const panels = section.querySelectorAll('.pillars-tab-content');
  panels.forEach((panel, i) => {
    panel.classList.toggle('active', i === index);
  });
  
  // Update content area border-radius based on active tab
  const contentArea = section.querySelector('.pillars-tab-panels');
  if (contentArea) {
    if (index === 0) {
      contentArea.classList.remove('round-top-left');
    } else {
      contentArea.classList.add('round-top-left');
    }
  }
}

// Initialize tab click handlers
document.addEventListener('DOMContentLoaded', function() {
  const sections = document.querySelectorAll('.pillars-tabs-section');
  sections.forEach(section => {
    const buttons = section.querySelectorAll('.pillars-tab-btn');
    buttons.forEach((button, index) => {
      button.addEventListener('click', function() {
        switchPillarsTab(section.id, index);
      });
    });
  });
});
</script>
