{{/*
@component: Language Selector
@description: Displays a language switcher using country flags.
@params:
  This component doesn't accept any parameters, it automatically detects available languages and translations.
@example:
  {{ partial "components/navigation/language-selector.html" . }}
*/}}

{{ $currentPage := . }}
{{ $currentLang := .Language.Lang }}

<div class="language-selector">
  <div class="flex flex-wrap items-center justify-center gap-3">
    {{ range site.Languages }}
      {{ $lang := .Lang }}
      {{ $isCurrent := eq $lang $currentLang }}
      {{ $countryCode := partial "helpers/get-country-code.html" (dict "code" $lang) }}
      {{ $flagUrl := printf "/flags/%s.png" $countryCode }}
      
      {{ if $isCurrent }}
        {{/* 現在の言語（薄く表示） */}}
        <span class="inline-flex items-center text-sm opacity-50" title="{{ .LanguageName }}">
          <img 
            src="{{ $flagUrl }}"
            alt="{{ .LanguageName }}"
            width="24"
            height="18"
            class="rounded"
          >
        </span>
      {{ else }}
        {{/* 対応する翻訳ページを探す */}}
        {{ $targetUrl := "" }}
        {{ $translationFound := false }}
        
        {{/* .Translationsを使って翻訳を確認 */}}
        {{ range $currentPage.Translations }}
          {{ if eq .Lang $lang }}
            {{ $targetUrl = .RelPermalink }}
            {{ $translationFound = true }}
          {{ end }}
        {{ end }}
        
        {{/* 翻訳が見つからない場合は、その言語のホームページにリンク */}}
        {{ if not $translationFound }}
          {{ $targetUrl = printf "/%s/" $lang }}
        {{ end }}
        
        <a href="{{ $targetUrl }}"
           class="inline-flex items-center text-sm hover:opacity-75 transition-opacity" 
           title="{{ .LanguageName }}"
           aria-label="{{ .LanguageName }}"
           hreflang="{{ $lang }}">
          <img 
            src="{{ $flagUrl }}"
            alt="{{ .LanguageName }}"
            width="24"
            height="18"
            class="rounded"
          >
        </a>
      {{ end }}
    {{ end }}
  </div>
</div>
