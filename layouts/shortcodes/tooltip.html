{{/*
  Smart Tooltip System - Tailwind Version
  hugo-boilerplate用に最適化
  
  使用例: {{< tooltip text="用語の説明" >}}専門用語{{< /tooltip >}}
  
  パラメータ:
  - text: ツールチップに表示する説明文（必須）
*/}}

{{- $text := .Get "text" -}}
{{- $term := .Inner | htmlUnescape -}}

{{- if not $text -}}
  {{- errorf "tooltip shortcode requires 'text' parameter in %s" .Position -}}
{{- end -}}

<span class="tooltip-wrapper relative inline-block group" 
      role="button" 
      tabindex="0" 
      aria-describedby="tooltip-{{ .Ordinal }}"
      aria-expanded="false"
      data-tooltip-id="{{ .Ordinal }}">
  
  <!-- ツールチップ対象の用語 -->
  <span class="tooltip-term text-primary-600 dark:text-primary-400 underline decoration-dotted cursor-help transition-colors duration-200 hover:text-primary-700 dark:hover:text-primary-300">
    {{- $term | safeHTML -}}
  </span>
  
  <!-- デスクトップ用ツールチップ -->
  <span class="tooltip hidden md:block invisible opacity-0 group-hover:visible group-hover:opacity-100 group-focus:visible group-focus:opacity-100 absolute bottom-full left-1/2 -translate-x-1/2 -translate-y-2 bg-gray-900 dark:bg-gray-800 text-white text-sm leading-relaxed px-3 py-2 rounded-lg shadow-xl whitespace-normal max-w-xs w-max z-[1000] transition-all duration-300 ease-out transform group-hover:-translate-y-3 group-focus:-translate-y-3 pointer-events-none"
        id="tooltip-{{ .Ordinal }}" 
        role="tooltip">
    {{- $text | safeHTML -}}
    
    <!-- 矢印 -->
    <span class="absolute top-full left-1/2 -translate-x-1/2 border-[6px] border-transparent border-t-gray-900 dark:border-t-gray-800"></span>
  </span>
  
  <!-- モバイル用ツールチップ（Tailwindのモーダルスタイル） -->
  <span class="tooltip-mobile md:hidden fixed inset-x-5 top-1/2 -translate-y-1/2 bg-gray-900/95 dark:bg-gray-800/95 backdrop-blur-sm text-white text-base leading-relaxed px-4 py-3 rounded-xl shadow-2xl z-[1000] transition-all duration-300 opacity-0 invisible pointer-events-none"
        data-mobile-tooltip="{{ .Ordinal }}">
    {{- $text | safeHTML -}}
  </span>
</span>
