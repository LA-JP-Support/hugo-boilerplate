{{ define "main" }}
<style>
/* 用語集ページではモバイルのみヘッダーを固定しない */
@media (max-width: 1023px) {
  header.bg-white { position: relative !important; }
}
</style>
<article class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
  <!-- ヘッダーセクション（改善版） -->
  <header class="py-6 sm:py-12">
    <div class="mx-auto max-w-4xl">
      <!-- パンくずリスト -->
      <div class="mb-4 sm:mb-8">
        <nav class="text-sm hidden sm:block">
          <ol class="flex items-center space-x-2 text-gray-400 dark:text-gray-500">
            <li class="flex items-center">
              <a href="/{{ .Language.Lang }}/" class="hover:text-gray-900 dark:hover:text-gray-300 transition-colors flex items-center">
                <img src="{{ partial "functions/get-localized-image.html" "/images/home-icon.png" }}" alt="Home" class="h-4 w-4 opacity-60">
              </a>
            </li>
            <li><span class="mx-2 text-gray-300 dark:text-gray-600">/</span></li>
            <li>
              <a href="/{{ .Language.Lang }}/glossary/" class="hover:text-gray-900 dark:hover:text-gray-300 transition-colors">
                {{ if eq .Language.Lang "ja" }}用語集{{ else }}Glossary{{ end }}
              </a>
            </li>
            <li><span class="mx-2 text-gray-300 dark:text-gray-600">/</span></li>
            <li class="text-gray-600 dark:text-gray-400 truncate max-w-xs">{{ .Title }}</li>
          </ol>
        </nav>
      </div>

      <!-- カテゴリーバッジ（シンプル版） -->
      {{ if .Params.category }}
        <div class="mb-6">
          <span class="inline-flex items-center text-xs font-medium tracking-wider uppercase text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-600 pb-1">
            <svg class="mr-2 h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
            </svg>
            {{ .Params.category }}
          </span>
        </div>
      {{ end }}

      <!-- タイトル（大きく、余白を広く） -->
      <h1 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-3xl md:text-4xl leading-tight mb-2">
        {{ .Title }}
      </h1>
      {{ if and (eq .Language.Lang "ja") (or (index .Params "e-title") .Params.translationKey) }}
        <p class="text-sm sm:text-base text-gray-500 dark:text-gray-400 mb-6">
          {{ (index .Params "e-title") | default (humanize .Params.translationKey) }}
        </p>
      {{ else }}
        <div class="mb-6"></div>
      {{ end }}

      <!-- 説明（読みやすく） -->
      {{ if .Description }}
        <p class="text-base sm:text-lg leading-relaxed text-gray-600 dark:text-gray-300 font-light max-w-3xl">
          {{ .Description }}
        </p>
      {{ end }}

      <!-- 区切り線（細く） -->
      <div class="mt-6 mb-4 border-t border-gray-100 dark:border-gray-800"></div>

      <!-- 下部メタ情報（キーワード＋更新日） -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <!-- キーワードタグ（ミニマル版） -->
        {{ if .Params.keywords }}
          <div class="flex flex-wrap gap-2">
            {{ range .Params.keywords }}
              <span class="inline-flex items-center px-2.5 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 bg-transparent border border-gray-200 dark:border-gray-700 rounded hover:border-gray-400 dark:hover:border-gray-500 transition-colors">
                {{ . }}
              </span>
            {{ end }}
          </div>
        {{ end }}

        <!-- 作成日 / 更新日 -->
        {{ partial "components/page-dates.html" . }}
      </div>
    </div>
  </header>

  <!-- 記事本文 -->
  <div class="prose prose-base sm:prose-lg dark:prose-invert mx-auto max-w-4xl py-6 sm:py-8">
    {{ .Content }}
  </div>

  <!-- 関連用語（Related Content機能を使用：glossaryセクションのみ対象） -->
  {{ $glossaryPages := where .Site.RegularPages "Section" "glossary" }}
  {{ $relatedTerms := $glossaryPages.Related . | first 6 }}
  
  {{ if $relatedTerms }}
    {{ $currentPage := . }}
    <div class="mt-16 sm:mt-20 border-t border-gray-200 dark:border-gray-800 pt-12 sm:pt-16">
      <h2 class="text-2xl sm:text-3xl font-bold tracking-tight text-gray-900 dark:text-white mb-8 sm:mb-10">
        {{ if eq .Language.Lang "ja" }}
          関連用語
        {{ else }}
          Related Terms
        {{ end }}
      </h2>
      <div class="grid gap-6 sm:gap-8 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
        {{ range $relatedTerms }}
          <article class="group relative flex flex-col overflow-hidden border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 hover:border-gray-400 dark:hover:border-gray-500 transition-all duration-300">
              <div class="flex flex-1 flex-col p-5 sm:p-6">
                <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white line-clamp-2 mb-3">
                  <a href="{{ .Permalink }}" class="hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                    {{ .Title }}
                  </a>
                </h3>
                {{ if .Description }}
                  {{ $desc := .Description }}
                  {{ if gt (len $desc) 100 }}
                    {{ $desc = substr $desc 0 100 | printf "%s..." }}
                  {{ end }}
                  <p class="text-sm text-gray-600 dark:text-gray-400 flex-1 line-clamp-3">
                    {{ $desc }}
                  </p>
                {{ end }}
                <div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-800">
                  <a 
                    href="{{ .Permalink }}" 
                    class="inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 group-hover:translate-x-1 transition-transform"
                  >
                    {{ if eq $currentPage.Language.Lang "ja" }}詳細を見る{{ else }}View details{{ end }}
                    <svg class="ml-1.5 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                  </a>
                </div>
              </div>
            </article>
          {{ end }}
        </div>
      </div>
    {{ end }}


  <!-- 用語集に戻るリンク -->
  <div class="mt-12 sm:mt-16 py-8 border-t border-gray-200 dark:border-gray-800">
    <a 
      href="/{{ .Language.Lang }}/glossary/" 
      class="inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
    >
      <svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      {{ if eq .Language.Lang "ja" }}
        用語集に戻る
      {{ else }}
        Back to Glossary
      {{ end }}
    </a>
  </div>
</article>
{{ end }}
