{{ define "main" }}
<!-- ヒーローセクション全体（グラデーション背景付き） -->
<div class="relative overflow-visible z-10">
  <div class="blog-hero-animated-bg absolute inset-0 z-0"></div>
  <div class="blog-hero-overlay absolute inset-0 z-0"></div>
  <div class="blog-hero-glow absolute inset-0 z-[5]" id="blogHeroGlow">
    <div class="blog-hero-glow-orb" id="blogHeroGlowOrb"></div>
  </div>
  <div class="relative z-10 py-12 sm:py-16">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <!-- ヘッダーセクション -->
    <div class="mb-5 sm:mb-7">
      <div class="mx-auto max-w-2xl text-center">
        <h1 class="text-3xl font-bold tracking-tight text-white sm:text-4xl md:text-5xl">
          {{ i18n "blog_title" }}
        </h1>
        <p class="mt-4 sm:mt-6 text-base sm:text-lg leading-7 text-gray-200">
          {{ if eq .Language.Lang "ja" }}
            最新の技術情報やニュースをお届けします
          {{ else }}
            Latest technology news and updates
          {{ end }}
        </p>

        <div class="mt-5 sm:mt-6 max-w-xl mx-auto">
          {{ partial "search_field.html" (dict
            "type" "blog-archive-search"
            "marginClass" "mt-4"
            "directories" (slice "blog")
          ) }}
        </div>
      </div>

      {{/* 親タグとそれに属する子タグのマッピング（言語別） */}}
      {{ if eq .Language.Lang "ja" }}
        {{/* 日本語版 */}}
        {{ $parentTags := dict
          "AI" (slice "AI技術" "AI" "RAG" "LLM" "生成AI" "LLM評価" "ベンチマーク" "ChatGPT" "生産性" "テクノロジー")
          "チャットボット" (slice "チャットボット")
          "カスタマーサポート" (slice "カスタマーサポート" "チケットシステム" "FAQ" "ナレッジベース" "LiveAgent")
          "業務効率化" (slice "業務効率化" "中小企業" "SNS管理")
          "コンテンツ制作" (slice "コンテンツ制作")
          "マーケティング" (slice "コンテンツ戦略" "動画マーケティング" "アルゴリズム" "グロース")
          "YouTube動画紹介" (slice "YouTube")
        }}
        {{ $parentTagOrder := slice "AI" "チャットボット" "カスタマーサポート" "業務効率化" "コンテンツ制作" "マーケティング" "YouTube動画紹介" }}
        {{ $youtubeParentName := "YouTube動画紹介" }}

        {{/* 実際に記事に存在するタグを収集 */}}
        {{ $existingTags := slice }}
        {{ range $.Pages }}
          {{ with .Params.tags }}
            {{ range . }}
              {{ if not (in $existingTags .) }}
                {{ $existingTags = $existingTags | append . }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}

        {{/* youtubeVideoIDを持つ記事があるかチェック */}}
        {{ $hasYoutubeVideo := false }}
        {{ range $.Pages }}
          {{ if .Params.youtubeVideoID }}
            {{ $hasYoutubeVideo = true }}
          {{ end }}
        {{ end }}

        {{/* 記事が存在する親タグのみ表示 */}}
        {{ $activeParentTags := slice }}
        {{ range $parentTagOrder }}
          {{ $parent := . }}
          {{ $childTags := index $parentTags $parent }}
          {{ if and (eq $parent $youtubeParentName) $hasYoutubeVideo }}
            {{ if not (in $activeParentTags $parent) }}
              {{ $activeParentTags = $activeParentTags | append $parent }}
            {{ end }}
          {{ else }}
            {{ range $childTags }}
              {{ if in $existingTags . }}
                {{ if not (in $activeParentTags $parent) }}
                  {{ $activeParentTags = $activeParentTags | append $parent }}
                {{ end }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}

        {{ if gt (len $activeParentTags) 0 }}
          <div class="mt-4 mx-auto max-w-7xl px-6 lg:px-8">
            <div class="flex flex-wrap justify-center gap-2">
              {{ range $activeParentTags }}
                {{ $parent := . }}
                {{ $childTags := index $parentTags $parent }}
                <button
                  type="button"
                  class="blog-tag-filter inline-flex items-center rounded-full border border-gray-300 bg-white px-3 py-1 text-[10px] sm:text-[11px] font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-700"
                  data-tag="{{ delimit $childTags "," }}">
                  {{ $parent }}
                </button>
              {{ end }}
            </div>
          </div>
        {{ end }}

      {{ else }}
        {{/* 英語版 */}}
        {{ $parentTags := dict
          "AI" (slice "AI" "AI Technology" "RAG" "LLM" "LLMs" "Generative AI" "ChatGPT" "Productivity" "Technology")
          "Chatbot" (slice "Chatbot" "AI Chatbot" "Chatbot Types")
          "Customer Support" (slice "Customer Support" "Ticket System" "FAQ" "Knowledge Base" "LiveAgent" "Customer Experience")
          "Business Efficiency" (slice "Business Efficiency" "SMB" "SME" "Implementation Guide")
          "Content Creation" (slice "Content Creation")
          "Marketing" (slice "Content Strategy" "Video Marketing" "Algorithm" "Growth Hacking" "Marketing")
          "YouTube Videos" (slice "YouTube")
        }}
        {{ $parentTagOrder := slice "AI" "Chatbot" "Customer Support" "Business Efficiency" "Content Creation" "Marketing" "YouTube Videos" }}
        {{ $youtubeParentName := "YouTube Videos" }}

        {{/* 実際に記事に存在するタグを収集 */}}
        {{ $existingTags := slice }}
        {{ range $.Pages }}
          {{ with .Params.tags }}
            {{ range . }}
              {{ if not (in $existingTags .) }}
                {{ $existingTags = $existingTags | append . }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}

        {{/* youtubeVideoIDを持つ記事があるかチェック */}}
        {{ $hasYoutubeVideo := false }}
        {{ range $.Pages }}
          {{ if .Params.youtubeVideoID }}
            {{ $hasYoutubeVideo = true }}
          {{ end }}
        {{ end }}

        {{/* 記事が存在する親タグのみ表示 */}}
        {{ $activeParentTags := slice }}
        {{ range $parentTagOrder }}
          {{ $parent := . }}
          {{ $childTags := index $parentTags $parent }}
          {{ if and (eq $parent $youtubeParentName) $hasYoutubeVideo }}
            {{ if not (in $activeParentTags $parent) }}
              {{ $activeParentTags = $activeParentTags | append $parent }}
            {{ end }}
          {{ else }}
            {{ range $childTags }}
              {{ if in $existingTags . }}
                {{ if not (in $activeParentTags $parent) }}
                  {{ $activeParentTags = $activeParentTags | append $parent }}
                {{ end }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}

        {{ if gt (len $activeParentTags) 0 }}
          <div class="mt-4 mx-auto max-w-7xl px-6 lg:px-8">
            <div class="flex flex-wrap justify-center gap-2">
              {{ range $activeParentTags }}
                {{ $parent := . }}
                {{ $childTags := index $parentTags $parent }}
                <button
                  type="button"
                  class="blog-tag-filter inline-flex items-center rounded-full border border-gray-300 bg-white px-3 py-1 text-[10px] sm:text-[11px] font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-700"
                  data-tag="{{ delimit $childTags "," }}">
                  {{ $parent }}
                </button>
              {{ end }}
            </div>
          </div>
        {{ end }}
      {{ end }}
    </div>
    </div>
  </div>
</div>

<!-- ブログ記事セクション -->
<div class="bg-white dark:bg-gray-900 py-6 sm:py-8 lg:py-10">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">

    <!-- ブログ記事グリッド -->
    <div id="blog-articles-grid" class="mx-auto mt-6 grid max-w-2xl auto-rows-fr grid-cols-1 gap-6 sm:gap-8 sm:mt-8 lg:mx-0 lg:max-w-none lg:grid-cols-3">
      {{ range .Pages }}
        {{/* 記事のタグを収集（youtubeVideoIDがあればYouTubeも追加） */}}
        {{ $articleTags := .Params.tags | default slice }}
        {{ if .Params.youtubeVideoID }}
          {{ if not (in $articleTags "YouTube") }}
            {{ $articleTags = $articleTags | append "YouTube" }}
          {{ end }}
        {{ end }}
        <article class="blog-article relative isolate flex flex-col justify-end overflow-hidden rounded-2xl bg-gray-900 dark:bg-gray-800 px-6 sm:px-8 pb-6 sm:pb-8 pt-64 sm:pt-48 lg:pt-80 shadow-lg hover:shadow-xl transition-shadow duration-300" data-tags="{{ delimit $articleTags "," }}">
          {{ if .Params.image }}
            <img 
              src="{{ partial "functions/get-localized-image.html" .Params.image }}" 
              alt="{{ .Title }}" 
              class="absolute inset-0 -z-10 h-full w-full object-cover"
            >
          {{ else }}
            <div class="absolute inset-0 -z-10 bg-gradient-to-t from-gray-900 via-gray-900/40"></div>
          {{ end }}
          <div class="absolute inset-0 -z-10 bg-gradient-to-t from-gray-900 via-gray-900/40"></div>
          <div class="absolute inset-0 -z-10 rounded-2xl ring-1 ring-inset ring-gray-900/10"></div>

          <div class="flex flex-wrap items-center gap-y-1 overflow-hidden text-sm leading-6 text-gray-300">
            <time datetime="{{ .Date.Format "2006-01-02" }}" class="mr-4 sm:mr-8 text-xs sm:text-sm">
              {{ if eq .Language.Lang "ja" }}
                {{ .Date.Format "2006年1月2日" }}
              {{ else }}
                {{ .Date.Format "January 2, 2006" }}
              {{ end }}
            </time>
            {{ if .Params.tags }}
              {{ range first 2 .Params.tags }}
                <span class="rounded-full bg-white/10 px-2 sm:px-3 py-1 text-xs font-medium text-white mr-2">
                  {{ . }}
                </span>
              {{ end }}
            {{ end }}
          </div>
          <h3 class="mt-3 text-base sm:text-lg font-semibold leading-6 text-white">
            <a href="{{ .RelPermalink }}" class="hover:text-indigo-300 transition-colors">
              <span class="absolute inset-0"></span>
              {{ .Title }}
            </a>
          </h3>
          {{ if .Description }}
            <p class="mt-2 text-xs sm:text-sm leading-5 sm:leading-6 text-gray-300 line-clamp-2">
              {{ .Description }}
            </p>
          {{ end }}
        </article>
      {{ end }}
  </div>
</div>

<style>
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes float {
  0%, 100% { transform: translate(0px, 0px); }
  25% { transform: translate(30px, -50px); }
  50% { transform: translate(-20px, -100px); }
  75% { transform: translate(-50px, -50px); }
}

.blog-hero-animated-bg {
  background: linear-gradient(135deg, #1d4ed8 0%, #7c3aed 25%, #db2777 50%, #06b6d4 75%, #1d4ed8 100%);
  background-size: 400% 400%;
  animation: gradientShift 10s ease infinite;
}

.blog-hero-animated-bg::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 420px;
  height: 420px;
  background: rgba(255,255,255,0.10);
  border-radius: 50%;
  animation: float 20s ease-in-out infinite;
}

.blog-hero-animated-bg::after {
  content: '';
  position: absolute;
  bottom: 0;
  right: 0;
  width: 320px;
  height: 320px;
  background: rgba(255,255,255,0.10);
  border-radius: 50%;
  animation: float 25s ease-in-out infinite reverse;
}

.blog-hero-overlay {
  background: linear-gradient(180deg, rgba(2, 6, 23, 0.12) 0%, rgba(2, 6, 23, 0.26) 100%);
  pointer-events: none;
}

.blog-hero-glow {
  pointer-events: none;
}

.blog-hero-glow-orb {
  position: absolute;
  width: 280px;
  height: 280px;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.22) 0%, rgba(255, 255, 255, 0.00) 70%);
  border-radius: 50%;
  filter: blur(44px);
  transform: translate(-50%, -50%);
  opacity: 0.9;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById('popup-search-input-blog-archive-search');
  const articlesGrid = document.getElementById('blog-articles-grid');
  const articles = document.querySelectorAll('.blog-article');
  const buttons = document.querySelectorAll('.blog-tag-filter');
  let activeFilter = null;

  // タグボタンのクリックでOR検索フィルタリング
  buttons.forEach(function(btn) {
    btn.addEventListener('click', function() {
      const tagString = this.getAttribute('data-tag');
      if (!tagString) return;

      const filterTags = tagString.split(',').map(t => t.trim().toLowerCase());
      const parentName = this.textContent.trim();

      // 同じボタンを再度クリックしたらフィルター解除
      if (activeFilter === parentName) {
        activeFilter = null;
        articles.forEach(function(article) {
          article.style.display = '';
        });
        // ボタンのアクティブ状態を解除
        buttons.forEach(function(b) {
          b.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
          b.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
        });
        if (input) input.value = '';
        return;
      }

      activeFilter = parentName;

      // ボタンのアクティブ状態を更新
      buttons.forEach(function(b) {
        if (b === btn) {
          b.classList.remove('bg-white', 'text-gray-700', 'border-gray-300');
          b.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
        } else {
          b.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
          b.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
        }
      });

      // OR検索：いずれかのタグがマッチすれば表示
      articles.forEach(function(article) {
        const articleTagsAttr = article.getAttribute('data-tags') || '';
        const articleTags = articleTagsAttr.split(',').map(t => t.trim().toLowerCase()).filter(t => t.length > 0);

        // タグがない記事はマッチしない
        if (articleTags.length === 0) {
          article.style.display = 'none';
          return;
        }

        const hasMatch = filterTags.some(function(filterTag) {
          return articleTags.some(function(articleTag) {
            return articleTag === filterTag;
          });
        });

        article.style.display = hasMatch ? '' : 'none';
      });

      // 検索ボックスに親タグ名を表示
      if (input) {
        input.value = parentName;
      }
    });
  });

  // 検索ボックスの入力をクリアしたらフィルターも解除
  if (input) {
    input.addEventListener('input', function() {
      if (this.value === '') {
        activeFilter = null;
        articles.forEach(function(article) {
          article.style.display = '';
        });
        buttons.forEach(function(b) {
          b.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
          b.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
        });
      }
    });
  }

  const glowOrb = document.getElementById('blogHeroGlowOrb');
  const heroGlow = document.getElementById('blogHeroGlow');

  if (!glowOrb || !heroGlow) return;

  document.addEventListener('mousemove', function(e) {
    const glowRect = heroGlow.getBoundingClientRect();
    const relativeX = e.clientX - glowRect.left;
    const relativeY = e.clientY - glowRect.top;

    requestAnimationFrame(function() {
      glowOrb.style.left = relativeX + 'px';
      glowOrb.style.top = relativeY + 'px';
    });
  });
});
</script>

{{ end }}
